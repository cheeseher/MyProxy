# Surge 配置使用手册 (By-Shane 版)

本文档将指导您如何正确导入、配置和使用 `By-Shane` 专属 Surge 配置。

### ✨ 本版亮点 (v2025)
*   **🎵 TikTok 解锁**: 内置 2025 最新通用脚本与广泛的 MITM Hostnames，支持换区 (默认日本/美国)。
*   **💰 加密货币优化**: 专属策略组，直连或优选节点访问 OKX, Binance, Bybit 等，交易快人一步。
*   **🏦 银行零误杀**: 针对中银香港、盈立证券、汇丰等强制 Skip Proxy，彻底解决登录报错。
*   **🔄 自动更新工作流**: 支持"引用模式"，配置自动更新且不覆盖您的订阅链接。

## 📥 1. 导入配置

您的专属托管配置链接为：
```text
https://raw.githubusercontent.com/cheeseher/MyProxy/main/By-Shane.conf
```

**操作步骤**：
1.  打开 Surge (iOS/Mac)。
2.  点击配置列表 -> **从 URL 下载配置** / **安装托管配置**。
3.  粘贴上述链接并保存。
4.  **重要**：导入后，请务必修改配置中的 `[Proxy Group]` -> `我的订阅`，填入您的机场订阅地址（如果您之前没填的话）。

---

## 🛠 2. 关键设置：MITM (必读)

**Q: 我是否需要开启 MITM (解密 HTTPS 流量)？**
**A: 强烈建议开启！**

如果不开启 MITM，以下功能将**失效**：
*   ❌ 广告拦截 (尤其是 YouTube、Spotify、开屏广告等)。
*   ❌ 精准分流 (某些应用需要解密 HTTPS 才能识别域名)。
*   ❌ 脚本功能 (如京东/淘宝自动签到等)。

**开启步骤 (iOS)**：
1.  在 Surge 首页，点击 **"MitM"** 模块（如果没有，去配置 -> 编辑 -> MitM -> 开启）。
2.  点击 **"配置根证书"** -> **"生成新的 CA 证书"**。
3.  点击 **"安装证书"**，跳转到 Safari 下载配置文件。
4.  前往 iOS **设置** -> **已下载的描述文件** -> 安装 Surge 证书。
5.  **最关键一步**：前往 iOS **设置** -> **通用** -> **关于本机** -> **证书信任设置** -> 找到 Surge 证书 -> **开启开关 (信任)**。

**开启步骤 (Mac)**：
1.  点击 Surge 菜单栏图标 -> **Dashboard** (仪表盘)。
2.  左侧栏选择 **"MitM"**。
3.  点击 **"配置根证书"** -> **"安装证书"**。
4.  在“钥匙串访问”中找到 Surge 证书，双击打开 -> **信任** -> 选择 **"始终信任"**。

### 2.1 高级选项设置建议
在开启 MITM 后，您可能会看到几个高级选项，建议如下设置：

*   **跳过服务端证书验证 (Skip Server Certificate Verification)**: **关闭**。
    *   *原因*：开启虽然方便，但会带来巨大的安全风险（中间人攻击），除非您非常清楚自己在做什么。
*   **MITM over HTTP/2**: **开启**。
    *   *原因*：现代网站大多使用 HTTP/2，开启后能提升抓包和解密的性能。
*   **自动屏蔽 QUIC (Block QUIC)**: **开启**。
    *   *原因*：YouTube、Google 等服务使用 QUIC (UDP) 协议，Surge 很难解密 QUIC 流量。屏蔽后，它们会回退到 HTTPS (TCP)，从而让 Surge 能成功去广告和分流。**这是去广告失效的常见原因。**

---

## 🎮 3. 策略组选择指南

为了获得最佳体验，请参考以下默认选择建议：

### 🌟 核心策略组 (Core)
| 策略组名称 | 推荐选择 | 说明 |
| :--- | :--- | :--- |
| **🚀 节点选择** | `♻️ 自动选择` | 主流量入口，所有未匹配规则的流量都走这里。 |
| **♻️ 自动选择** | (自动) | 系统会自动测速并选择最快的节点。 |
| **🤖 人工智能** | `♻️ 自动选择` | ChatGPT, Claude 等。若遇地区限制，可手动锁 `🇺🇸 美国节点`。 |
| **📲 电报消息** | **`🇸🇬 新加坡节点`** | **防断连核心**：建议手动锁定新加坡或香港。 |
| **🎬 国际媒体** | `♻️ 自动选择` | YouTube, Netflix 等。想看特定区内容可手动切换。 |
| **💰 加密货币** | `🇯🇵 日本节点` | 专为 OKX/Binance 优化。推荐 Japan/Singapore 以获最佳延迟。 |
| **🎵 TikTok** | `🇺🇸 美国节点` | **需开启模块**。支持解锁黑屏，看美区/日区小姐姐。 |

### 💼 办公与开发 (Work & Dev)
| 策略组名称 | 推荐选择 | 说明 |
| :--- | :--- | :--- |
| **📹 Zoom会议** | **`🎯 全局直连`** | 国内直连最稳。如果卡顿，尝试切 `🇭🇰 香港节点`。 |
| **💬 群晖办公** | **`🎯 全局直连`** | 访问公司 NAS。若需外网访问，请选 `🚀 节点选择`。 |
| **🐱 GitHub** | `♻️ 自动选择` | 加速代码 Clone/Push。 |
| **🍎 苹果服务** | `🎯 全局直连` | App Store 下载速度通常直连最快。 |
| **Ⓜ️ 微软服务** | `🎯 全局直连` | OneDrive 同步通常直连最快。 |

---

## 🔧 4. 流量捕获与调试 (Traffic Capture)

Surge 提供了强大的抓包功能，但**普通用户日常使用无需开启**，以免影响性能或隐私。

### 4.1 数据流量捕获 (Traffic Capture)
*   **什么是它**：开启后，Surge 会记录所有经过代理的 HTTP 请求头（Header）信息。
*   **什么时候开启**：仅当您需要查看某个 APP 到底访问了什么域名，或者为了**抓取 Cookie**（例如运行京东签到脚本）时开启。
*   **日常建议**：**关闭**。长期开启会占用内存并产生大量日志。

### 4.2 数据包捕获 (Packet Capture / Rewrite)
*   **什么是它**：这是比流量捕获更深层的功能，配合 MITM 可以解密 HTTPS 内容，查看请求体（Body）。
*   **什么时候开启**：
    *   如果您使用了**重写 (Rewrite)** 规则（例如去广告、TikTok 换区），**必须开启**。
    *   如果您使用了**脚本 (Script)**，也必须开启。
*   **日常建议**：**开启**。本配置默认包含了去广告和分流脚本，建议保持 Rewrite 功能为开启状态。

---

## 📊 5. 服务连通性测试面板

为了方便您一目了然地检查关键服务（ChatGPT, Google, Netflix, Zoom, TG）是否连通，我为您内置了一个**连通性测试模块**。

**功能亮点**：
*   ✅ **真实地区检测**：自动检测 ChatGPT 的出口地区（如显示 🇺🇸 美国国旗），杜绝假节点。
*   ✅ **精美排版**：自动对齐，支持红/黄/绿三色延迟状态显示。
*   ✅ **并发测速**：5 个目标网站并发检测，速度飞快。

### 启用方法 (iOS)
1.  在 Surge 首页底部，点击 **"模块" (Modules)**。
2.  点击 **"安装新模块"**。
3.  粘贴模块链接 (CDN 加速)：
    ```text
    https://cdn.jsdelivr.net/gh/cheeseher/MyProxy@main/Modules/Connectivity-Test.sgmodule
    ```
4.  安装后，您的 Surge 首页会出现一个新的面板，实时显示各服务的连接状态。

---

## 🔄 6. 自动更新工作流 (进阶)

如果您希望 **Surge 配置能自动从 GitHub 更新 (获取最新规则/脚本)**，但又**不想每次都重新填写订阅链接**，请使用此方案。

### 6.1 原理
*   **云端配置 (`By-Shane.conf`)**: 包含核心逻辑、规则、脚本。由我维护更新。
*   **本地配置 (`Private.conf`)**: 您本地创建的空壳配置，**引用**云端配置，并**填入**您的订阅。

### 6.2 设置步骤
1.  在 Surge 配置列表，选择 **"创建新配置"** -> **"创建文本配置"**。
2.  清空内容，粘贴以下模板：
    ```ini
    #!name=Shane 私有配置 (Local)
    #!desc=引用云端逻辑，覆盖私有订阅

    [General]
    # 引用云端主配置 (自动保持最新)
    #!include = https://raw.githubusercontent.com/cheeseher/MyProxy/main/By-Shane.conf

    [Proxy Group]
    # 覆盖"我的订阅"策略组，填入你的真实订阅链接
    我的订阅 = select, policy-path=您的机场订阅链接, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0
    ```
3.  将 `policy-path=` 后的文字替换为您真实的订阅链接。
4.  保存并使用此配置。以后云端更新时，您只需点击"更新外部资源"或等待自动刷新即可。

## 📖 6. 快捷使用手册

为了方便查阅，我已经将本文档的链接直接置入配置文件的顶部注释中。

您可以在 Surge 中：
1.  进入 **配置列表**。
2.  长按当前使用的配置 -> **编辑**。
3.  在文件最顶部即可点击链接直接跳转。

---

## ❓ 7. 常见问题 (Q&A)

**Q: 为什么 Telegram 语音还是偶尔会断？**
A: 请检查 `电报消息` 策略组是否选了 `自动选择`。请改为手动选择一个固定的 `新加坡` 节点。另外，确保您使用的节点支持 UDP（通常 IEPL/IPLC 专线都支持）。

**Q: 为什么我看不到“全局直连”这个选项，只有 DIRECT？**
A: `🎯 全局直连` 是我们配置的中文别名。如果您只看到 `DIRECT`，说明配置文件可能未更新，请长按配置 -> **立即更新**。

**Q: GitHub 上传代码还是慢怎么办？**
A: Surge 只能接管系统 HTTP 流量。对于终端 (Terminal) 和 Git，建议在终端执行以下命令设置代理：
```bash
# 端口根据 Surge Mac 设置调整 (默认 6152)
export https_proxy=http://127.0.0.1:6152 http_proxy=http://127.0.0.1:6152 all_proxy=socks5://127.0.0.1:6153
```

**Q: 为什么有些广告去不掉？**
A: 
1. 检查是否开启了 MITM 并信任了证书。
2. 广告商也在不断更新，规则可能存在滞后。
3. 部分应用（如 Facebook/Instagram）的广告很难通过 Surge 彻底去除。

**Q: 银行/证券 App (如中银、盈立) 无法登录或报错？**
A: 我们已将以下银行/证券 App 的域名加入 `skip-proxy` (强制直连)，确保 0 误杀、0 报错：
*   **银行**: 中银香港 (BOCHK), 汇丰 (HSBC), 众安 (ZA Bank), 花旗 (Citibank), 渣打 (Standard Chartered)
*   **证券**: 盈立 (uSMART), 富途 (Futu), 复星财富 (Fosun Wealth)
如果仍有问题，请尝试关闭 Surge 再试。若确认是 Surge 导致，请反馈域名，我们会加入白名单。

2. 广告商也在不断更新，规则可能存在滞后。
3. 部分应用（如 Facebook/Instagram）的广告很难通过 Surge 彻底去除。
